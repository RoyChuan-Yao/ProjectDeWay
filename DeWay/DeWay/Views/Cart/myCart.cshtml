@model IEnumerable<DeWay.Models.Cart_OrderDetail>

@{
    ViewBag.Title = "我的購物車";
    IEnumerable<DeWay.Models.Cart_OrderDetail> selectBySelID = Model.OrderBy(m => m.Specification.Product.selID);
}

<h2 class="mb-3">@Html.DisplayFor(m => m.ToList()[0].Member.mbrName)的購物車</h2>

<div class="row">
    <div class="col-8">
        @Html.Partial("_CartCard", Model)
    </div>
    <div class="col-4">
        <div class="card sticky-top">
            <div class="card-header">
                訂單摘要
            </div>
            <div class="card">
                <p class="card-text">商品總計：<span id="priceTotal">NT$ 0</span></p>
                <p class="card-text">運費總計：<span id="shpTotal">NT$ 0</span></p>
                <hr />
                <a href="">使用優惠券、紅利或禮物卡</a>
            </div>
        </div>
    </div>
</div>
@section cartScript{
    <script>
        var len = $("input[type='checkbox']").length//檢查讀取了幾個商品項目

        //利用陣列存取誰被點選
        var checkStatus = [];
        for (var i = 0; i < len; i++) { //初始化陣列(預設0個商品被勾選)
            checkStatus.push(false);
        }

        //點選其中一個商品後，改變checkStatus
        function changeChckeStatus(arr, index) {
            arr[index] = !arr[index];
            updateTotalPrice(arr);//點選後更新訂單摘要
        }

        //更新訂單摘要
        function updateTotalPrice(arr) {
            var price, count, totalPrice = 0;
            for (i = 0; i < arr.length; i++) {
                if (arr[i] == true) {
                    //獲取被點選商品的價格與數量
                    price = parseInt($("#price_" + i).text());
                    count = parseInt($("#count_" + i).text());
                    //相乘後計算總價
                    totalPrice += price * count;
                }
            }
            //在欄位顯示總價
            $("#priceTotal").text("NT$ " + totalPrice);
        }
    </script>
}

